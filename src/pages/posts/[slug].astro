---
import getPostQuery from '../../queries/post'
import getAllPostSlugs from '../../queries/allPostSlugs'
import request from '../../lib/request'
import DefaultLayout from '../../layouts/default.astro'
import Container from '../../components/Container'
import PostHeader from '../../components/post-header'
import PostBody from '../../components/post-body'
import Comments from '../../components/comments'

const { slug } = Astro.params
const {
  data: { post }
} = await request(getPostQuery({ slug }))

export const getStaticPaths = async () => {
  const r = await request(getAllPostSlugs())
  return r.data.allPosts?.map(slug => ({ params: slug }))
}
---

<DefaultLayout {...{ title: post.title}}>
  <Container>
    <PostHeader {...post} />
    <PostBody {...post} />
    <Comments {...{title: post.title, url: Astro.url.href}} client:idle />
  </Container>
</DefaultLayout>
