---
import Container from '../../components/container'
import HeaderBlog from '../../components/header-blog'
import PostHeader from '../../components/post-header'
import PostBody from '../../components/post-body'
// import Comments from '../../components/comments'
import Layout from '../../components/layout'
import getPostQuery from '../../queries/post'
import getAllSlugs from '../../queries/allSlugs'
import request from '../../lib/request'

const { slug } = Astro.params

const parsedResponse = await request(getPostQuery({ slug }))
const post = parsedResponse.data.post

export async function getStaticPaths() {
  const parsedSlugResponse = await request(getAllSlugs())

  const pathsArray = []
  for (const slug of parsedSlugResponse.data.allPosts) {
    pathsArray.push({ params: slug })
  }
  return pathsArray
}
---

<Layout {...{currentSlug: `posts/${slug}`}}>
  <Container>
    <HeaderBlog />
    <article>
      <PostHeader {...post} />
      <PostBody {...post} />
      <!-- <Comments {...{title: post.title, url: Astro.url.href}} client:idle /> -->
    </article>
  </Container>
</Layout>
